process createPixelMatchElectrons = {

  ### keep the logging output to a nice level ###
  #include "FWCore/MessageLogger/data/MessageLogger.cfi"
  
  service = MessageLogger
  {
     untracked vstring destinations = {"cout"}
     untracked PSet cout = 
     {
       untracked  PSet default = { untracked int32 limit = 0 }
       #untracked  string threshold = "Debug"   
     }
  }

  source = PoolSource 
  { 
    #untracked vstring fileNames = {'rfio:/castor/cern.ch/user/c/charlot/CMSSW/data/CMSSW_0_7_0/evtgen_detsim_digi_rechits_clus_sclus_esinglePt30.root'}
    untracked vstring fileNames = {'file:/tmp/evtgen_detsim_digi_rechits_clus_sclus_esinglePt10.root'}
    untracked int32 maxEvents = 10
    untracked uint32 debugVerbosity = 1
    untracked bool   debugFlag     = true
  }

  ############ initialize magnetic field #########################
  include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

  ############### initialize geometry #####################
  #include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
  include "Geometry/TrackerRecoData/data/trackerRecoGeometryXML.cfi"
  include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
  include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
  include "RecoTracker/GeometryESProducer/data/TrackerRecoGeometryESProducer.cfi"
   
  # my input file already contains tracker digis
  #include "SimTracker/SiPixelDigitizer/data/PixelDigi.cfi"	
  #include "SimTracker/SiStripDigitizer/data/SiStripDigi.cfi"
  
  ### Pixel Clusterizer and RecHit producer modules
  # my input file already contains pixel rechits and clusters
  #include "RecoLocalTracker/SiPixelClusterizer/data/SiPixelClusterizer.cfi"
  #include "RecoLocalTracker/SiPixelRecHits/data/SiPixelRecHits.cfi"

  ### SiliconStrip Clusterizer and RecHit producer modules
  include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_SimData.cfi"
  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"

  # this should be enough according to DigisToTrackCandidates.cfg
  ### StripCPEfromTrackAngleESProducer es_module
  include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"

  # pixelCPE
  include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEParmError.cfi"
  # TransientTrackingBuilder
  include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilder.cfi"
       
  module out = PoolOutputModule { 
   untracked string fileName ="/tmp/evtgen_detsim_digi_rechits_clus_sclus_pixelseeds_electrons_esinglePt10.root"}

  endpath outpath = { out }
        
  module elseed= ElectronPixelSeedProducer 
  {
    double ePhiMin1=-0.125
    double ePhiMax1=0.075
    double pPhiMin1=-0.075
    double pPhiMax1=0.125
    double pPhiMin2=-0.005
    double pPhiMax2=0.005
    double ZMin1=-15.0
    double ZMax1=15.0
    double ZMin2=-0.07
    double ZMax2=0.07
    double NSigmaInside = 3. 
    string superClusterLabel = ""
    string superClusterProducer = "correctedHybridSuperClusterProducer"
  }

  # CKFTrackCandidateMaker
  # broken down to the different components so to configure the Chi2MeasurementEstimatorESProducer
  #include "RecoTracker/CkfPattern/data/CkfTrackCandidates.cff"
  include "TrackingTools/KalmanUpdators/data/KFUpdatorESProducer.cfi"
  #include "TrackingTools/KalmanUpdators/data/Chi2MeasurementEstimatorESProducer.cfi"
  es_module = Chi2MeasurementEstimatorESProducer 
  {
    string ComponentName = "Chi2"   
    #double MaxChi2 = 30. 
    double MaxChi2 = 5. 
    double nSigma = 3.
  }
  include "TrackingTools/TrackFitters/data/KFTrajectoryFitterESProducer.cfi"
  include "TrackingTools/TrackFitters/data/KFTrajectorySmootherESProducer.cfi"
  include "TrackingTools/TrackFitters/data/KFFittingSmootherESProducer.cfi" 
  include "TrackingTools/MaterialEffects/data/MaterialPropagator.cfi"
  include "TrackingTools/MaterialEffects/data/OppositeMaterialPropagator.cfi"
  include "RecoTracker/CkfPattern/data/CkfTrackCandidates.cfi"
  
  module pixelmatchelectrons = PixelMatchElectronProducer
  {

    string SeedProducer         = "elseed"
    double ptCut                = 0.9
    int32  maxCand              = 5
    int32  maxLostHit           = 1
    int32  maxConsecLostHit     = 1
    double lostHitPenalty       = 30.
    bool   intermediateCleaning = true
    #int32  minimumNumberOfHits  = 5
    int32  minimumNumberOfHits  = 3
    bool   alwaysUseInvalidHits = true
    bool   seedCleaning         = false
    string TTRHBuilder          = "WithTrackAngle"

    # nested parameter set for MeasurementTracker
    PSet MeasurementTrackerParameters =
    {
      string PixelCPE = "PixelCPEParmError"
      #string StripCPE = "StripCPEfromTrackAngle"
      double NSigmaInside =3
    }
    
    double maxEOverP = 3.
    double maxHOverE = 0.1
    double maxDeltaEta = 0.02
    double maxDeltaPhi = 0.1

  }
 
  path p = {ThreeThresholdClusterizer,LocalMeasurementConverter,elseed,pixelmatchelectrons}

}
